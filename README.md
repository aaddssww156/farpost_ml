# Классификация товаров

Данный проект представляет собой создание классификатора товаров. В ходе работы были созданы две модели (для текстов и изображений), которые были использованы для создания микросервиса и контейнеризированы. Данные модели являются готовыми для работы

## Данные
Данные для текстовой модели были взяты с https://archive.ics.uci.edu/dataset/837/product+classification+and+clustering
Данные для модели с изображениями были взяты с https://www.kaggle.com/datasets/fatihkgg/ecommerce-product-images-18k?utm_source=chatgpt.com

### Текстовые данные
Текстовые данные представляют собой набор идентификаторов, текстовых описаний и категорий продуктов, которые требуется предсказать. Данные не содержат пропусков, дубликатов, а текстовое описание не содержит специальных символов или иных неприятных для обработки и дальшейшей работы данных.

### Данные изображений
Датасет с изображениями является готовым предобработанным датасетом для классификации. Данные заранее разделены на тестовую, обучающую и валидационную выборку. Все данные представлены в формате 128х128 изображений.

## Результаты работы

### Текстовая модель
Текстовая модель показала хорошие результаты без использования сторонних предобученных классификаторов, таких как BERT или иные трансформеры.

Для данной задачи так же хотелось провести анализ кластеров для возможного выявления дополнительных категорий. Такой подход может помочь на большем количестве категорий или при работе с датасетом, категории которого заранее не определены. Помимо этого, данный анализ позволили бы узнать, есть ли перекрывающиеся категории, которые возможно было бы объединить в одну.

Несмотря на хороший результат, модель может ошибаться с категориями Freezers, Fridges, Fridge Freezers, так как они имеют схожее текстовое описание. Если ошибки являются критичными, то эти категории можно обхединить в одну (если это позволительно), либо внимательнее и сильнее предобработать текстовые данные для лучшей классификации. Так же, более полное текстовое описание для каждого товара могло бы улучшить возможность модели для классификации данных категорий

### Модель с изображениями
Модель с изображениями показала не самые лучшие результаты даже для тестового датасета. Модель нередко ошибается даже на ручной проверке, что ставит под сомнение возможность использовать данную модель в реальной работе. Вероятно, вместо определения одного конкретного класса, было бы полезно определять вероятности отнесения изображения к тому или иному классу или использовать несколько изображений для лучшей классификации товара, объединяя их вероятности.

Для решения этой задачи разумным шагом было бы использовать предобученную модель, но при использовании resnet18 результаты были ужасные - около 18% для валидационной выборки. Скорее всего, я просто делал что-то не так, но для детального разбота с данной моделью у меня не хватило времени. 

## Возможные проблемы и подводные камни
* Перекрытие категорий - возможно, есть способ объединить некоторые категории для лучшей классификации, например, холодильные системы вместо холодильника и иных холодильных систем (если это позволительно). Так же, можно попробовать использовать несколько моделей, что может повысить возможность корректнее определять нужную категорию, но данный подход является более затратным по ресурсам и не гаратнирует улучшение релевантности результата.

* Многоуровневая структура каталога - для решения этой проблемы можно увеличить количество категорий, например, вместо категории камеры, ввести категории с указанием подкатегорий, например Камеры/Цифровые_камеры и Камеры/Беззеркальные_камеры. Для лучшей классификации, но количество категорий может кратно возрасти. Иным решением будет использование нескольких моделей, каждая из которых предсказывает свой уровень. То есть, первая модель предсказывает первый уровень категории, следующая - второй и так далее. Такой подход дороже в разработке, поддерживании и мониторинге. Так же, заранее неизвестна глубина подкатегорий, что может стать проблемой (сколько моделей создавать?). Может быть, вместо multiclass classification будет удобно использовать multilabel classification с классификацией класса товара и различных верхнеуровневых категорий в виде лейблов, а не классов

* Ошибочные данные, вводимые пользователем - если пользователь вводит текстовые данные, которые не соотносятся с наименованием или изображением товара, то мы можем использовать результат комбиации текста и изображения для лучшего понимания того, нужный ли товар указывается. Допустим, взять текстовое описание как приоритет и при получении изображения, которое относится к другому классу (текстовое описание камеры, а изображения холодильника) предупреждать пользователя о возможной ошибке. Если же пользователь опечатался, то можно использовать различные методы предобработки текста, например, расстояние Левенштейна. Так же, если пользователь хочет добавить товар, которого нет в нашей базе (допустим, совершенно новая категория), то мы можем взять порог для предсказания. Если ни один класс, о котором мы знаем, не подходит для корректной классификации, то мы можем сохранить эти данные для дальнейшего анализа. Если таких классов и их появлений будет достаточно много, то имеет смысл дообучить \ переобучить \ создать новую модель для учета новых данных.

## Подход к разработке
Вся работа по созданию моделей начиналась с анализа датасета, возможных подводных камней и природы данных. По завершению анализа, начиналась работа по изучению возможных моделей и подходов к работе и подбора метрик для их использования. Сначала использовались "самописные" модели для проверки результатов и целесообразности их тестирования. Если собственные модели показывали хороший результат, то далее проводилась работа по улучшению показатей модели и их сохранение. Так же, были предприняты попытки по использованию уже готовых моделей. Для текстовой задачи была использована попытка кластеризации товаров и использование готовых трансформеров, таких как BERT, но их результаты были либо хуже, либо для корректной реализации подобных решений нехватало времени. Для модели с изображениями была попытка применить готовую модель resnet18 с дообучением на своем датасете, но она показывала плохие результаты, несмотря на то, что использование готовой модели для такой задачи является лучшим вариантом, так как обучение своих решений является затратным по ресурсам и сложным занятием. 

После того, как данные были проанализированны, модели были обучены и протестированны, они были сохранены для дальнейшего использования в виде http микросервиса на FastAPI, где работу моделей можно протестировать и использовать в проде. Данный микросервис был контейнеризирован с помощью docker (compose)

В ходе разработки я принебрег тестированием, обработкой и отловом ошибок, проверкой датасета (допустим, на наличие нужных полей), оптимизацией решений, контейнеров и рассмотра большого количества моделей для решения задачи, так как на это потребовалось бы намного больше времени, но данные шаги являются важными в реальной разработке.

Вся работа проводилась в локально развернутом Jupyter Lab.

После выполнения всех этих шагов, был написан readme файл с документацией всех шагов и решений.

# Запуск, тестирование, использование
Работа велась на python версии 3.12.3
Все нужные для анализа и разработки моделей библиотеки сохранены в файле requirements.txt
Все нужные для работы в проде зависимости сохранены в requirements_docker.txt

### Установка зависимостей
Для запуска и работы рекомендуется развернуть вируальное окружение с помощью venv
```python
python -m venv venv

#Unix
source venv/bin/activate
```

Для установки зависимостей
```python
# Анализ
pip install -r requirements.txt

# Деплой
pip install -r requirements_docker.txt
```

### Запуск
Для анализа и разработки моделей использовалась Jupyter Lab, она же рекомендуется для разработки моделей

Для деплоя и создания микросервиса использовался docker (compose), но проект так же можно запустить локально командой
```python
uvicorn main:app --host 0.0.0.0 --port 8000
```

Используя докер
```bash
docker compose up --build <-d>
```
### Тестирование
Тестирование работы
```bash
# Текст 
curl -X POST "http://localhost:8000/v1/predict_text" -H "Content-Type: application/json" -d '{"text":"<Ваш текст на английском языке>"}'

# Изображения
curl -X POST "http://localhost:8000/v1/predict_image" -F "file=@<Путь до файла>"
```

### Результат
В качестве результата, текстовая модель возвращает наименование класса, в виде json
{"predicted_class": "sample"}

В качестве результата, модель с изображениями возвращает наименование класса и вероятности отнесения к классам
{
"predicted_class":"SPORTS_OUTDOOR",
"probabilities":     {"BABY_PRODUCTS":0.06762374937534332,"BEAUTY_HEALTH":0.047773174941539764,"CLOTHING_ACCESSORIES_JEWELLERY":0.054755162447690964,"ELECTRONICS":0.06374597549438477,"GROCERY":0.0810350775718689,"HOBBY_ARTS_STATIONERY":0.05489273741841316,"HOME_KITCHEN_TOOLS":0.027217445895075798,"PET_SUPPLIES":0.21822406351566315,"SPORTS_OUTDOOR":0.3847326338291168}
}